<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Feedback Report - {{ team_member.name }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #2c3e50;
        }

        h1 {
            color: #667eea;
            font-size: 24pt;
            margin-bottom: 10px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
        }

        h2 {
            color: #2c3e50;
            font-size: 16pt;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        h3 {
            color: #495057;
            font-size: 13pt;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .header-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .header-box strong {
            color: #1976D2;
            font-size: 12pt;
        }

        .info-section {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        .info-section p {
            margin: 5px 0;
        }

        .chart-container {
            margin: 20px 0;
            text-align: center;
            page-break-inside: avoid;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
        }

        .feedback-comment {
            background: #f8f9fa;
            padding: 10px 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            page-break-inside: avoid;
        }

        .manager-feedback-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            margin: 15px 0;
            border-radius: 4px;
            page-break-inside: avoid;
        }

        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            font-size: 9pt;
            color: #666;
            text-align: center;
        }

        .legend {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 14px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 10pt;
        }

        .no-data {
            color: #999;
            font-style: italic;
            padding: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Team Feedback Report</h1>

    <div class="header-box">
        <strong>Team Member:</strong> {{ team_member.name }}<br>
        <strong>Job Title:</strong> {{ team_member.job_title }}<br>
        <strong>Email:</strong> {{ team_member.email }}<br>
        <strong>Manager:</strong> {{ manager.name }}<br>
        <strong>Report Generated:</strong> {{ generation_date }}
    </div>

    <div class="info-section">
        <p><strong>Total Peer Feedback Received:</strong> {{ feedback_count }} feedback(s)</p>
    </div>

    <h2>Team Tenets - Butterfly Chart</h2>
    <p style="margin-bottom: 10px; color: #666; font-size: 10pt;">
        Aggregated feedback from all peers. Strengths shown in green (right), improvements in red (left).
    </p>

    <div class="legend">
        <strong>Legend:</strong> Highlighted tenets (brighter color, thicker border) were selected by the manager.
        Bar lengths include both peer feedback AND manager selection (each counts as +1).
    </div>

    <div class="chart-container">
        <img src="data:image/png;base64,{{ chart_image }}" alt="Butterfly Chart">
    </div>

    <h2>Peer Feedback Comments</h2>

    <h3>Strengths</h3>
    {% if strengths_comments|length == 0 %}
    <p class="no-data">No strength comments received yet.</p>
    {% else %}
    {% for comment in strengths_comments %}
    <div class="feedback-comment">
        {{ comment }}
    </div>
    {% endfor %}
    {% endif %}

    <h3 style="margin-top: 20px;">Areas for Improvement</h3>
    {% if improvements_comments|length == 0 %}
    <p class="no-data">No improvement comments received yet.</p>
    {% else %}
    {% for comment in improvements_comments %}
    <div class="feedback-comment">
        {{ comment }}
    </div>
    {% endfor %}
    {% endif %}

    {% if manager_feedback_text %}
    <h2>Manager Feedback</h2>
    <div class="manager-feedback-box">
        {{ manager_feedback_text }}
    </div>
    {% endif %}

    <div class="footer">
        <p>
            This report is confidential and intended for performance review purposes only.<br>
            Individual peer feedback is presented anonymously to protect contributor privacy.
        </p>
    </div>
</body>
</html>
